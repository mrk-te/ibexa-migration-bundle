# test creation/updating/deleting of a custom content type
# NB: assumes that 'folder' ContentType is available

-
    type: content_type
    mode: create
    content_type_group: 1
    name: Kaliop Migration Bundle Test Class 1
    identifier: kmb_test_1
    description: Kaliop Migration Bundle Test Class 1
    name_pattern: <title>
    default_always_available: true
    default_sort_field: priority
    default_sort_order: asc
    attributes:
        -
            type: ibexa_string
            name: Title
            identifier: title
            description: Title
            required: true
            searchable: true
    references:
        -
            identifier: kmb_test_003_1_identifier
            attribute: identifier
        -
            identifier: kmb_test_003_1_content_type_id
            attribute: content_type_id
        -
            identifier: kmb_test_003_1_creation_date
            attribute: creation_date
        -
            identifier: kmb_test_003_1_default_always_available
            attribute: default_always_available
        -
            identifier: kmb_test_003_1_default_sort_field
            attribute: default_sort_field
        -
            identifier: kmb_test_003_1_default_sort_order
            attribute: default_sort_order
        -
            identifier: kmb_test_003_1_is_container
            attribute: is_container
        -
            identifier: kmb_test_003_1_modification_date
            attribute: modification_date
        -
            identifier: kmb_test_003_1_name_pattern
            attribute: name_pattern
        -
            identifier: kmb_test_003_1_remote_id
            attribute: remote_id
        -
            identifier: kmb_test_003_1_status
            attribute: status
        -
            identifier: kmb_test_003_1_url_name_pattern
            attribute: url_name_pattern
        -
            identifier: kmb_test_003_1_content_type_identifier
            attribute: content_type_identifier
        -
            identifier: kmb_test_003_1_id
            attribute: id

-
    type: assert
    target: reference
    identifier: reference:kmb_test_003_1_identifier
    test:
        equals: kmb_test_1

-
    type: assert
    target: reference
    identifier: reference:kmb_test_003_1_content_type_identifier
    test:
        equals: kmb_test_1

-
    type: assert
    target: reference
    identifier: reference:kmb_test_003_1_content_type_id
    test:
        equals: reference:kmb_test_003_1_id

-
    type: assert
    target: reference
    identifier: reference:kmb_test_003_1_name_pattern
    test:
        equals: '<title>'

-
    type: content_type
    mode: update
    match:
        identifier: reference:kmb_test_003_1_identifier
    attributes:
        -
            type: ibexa_string
            name: Title
            identifier: title
            description: Title field
            required: false
            searchable: false
            disable-translation: true
            category: meta
            field-settings: []
            default-value: 'hello world'
        -
            type: ibexa_author
            name: ibexa_author
            identifier: ibexa_author
        -
            type: ibexa_binaryfile
            name: ibexa_binaryfile
            identifier: ibexa_binaryfile
            validator-configuration:
                FileSizeValidator: { maxFileSize: 123 }
        -
            type: ibexa_boolean
            name: ibexa_boolean
            identifier: ibexa_boolean
            default-value: true
        -
            type: ibexa_country
            name: ibexa_country
            identifier: ibexa_country
            field-settings:
                isMultiple: true
            default-value: [ AF ]
        -
            type: ibexa_datetime
            name: ibexa_datetime
            identifier: ibexa_datetime
            field-settings:
                defaultType: 1
                useSeconds: true
                dateInterval: null
        -
            type: ibexa_date
            name: ibexa_date
            identifier: ibexa_date
            field-settings:
                defaultType: 1
        -
            type: ibexa_email
            name: ibexa_email
            identifier: ibexa_email
        -
            type: ibexa_float
            name: ibexa_float
            identifier: ibexa_float
            validator-configuration:
                FloatValueValidator: { minFloatValue: 42, maxFloatValue: 43 }
            default-value: 42.42
        # @todo ibexa_gmap_location fieldType seems to be enabled by default, but the db table might *not* be present...
        #-
        #    type: ibexa_gmap_location
        #    name: ibexa_gmap_location
        #    identifier: ibexa_gmap_location
        -
            type: ibexa_image
            name: ibexa_image
            identifier: ibexa_image
            validator-configuration:
                FileSizeValidator: { maxFileSize: 234 }
        -
            type: ibexa_integer
            name: ibexa_integer
            identifier: ibexa_integer
            validator-configuration:
                IntegerValueValidator: { minIntegerValue: -100, maxIntegerValue: 100 }
            default-value: 42
        -
            type: ibexa_isbn
            name: ibexa_isbn
            identifier: ibexa_isbn
        -
            type: ibexa_keyword
            name: ibexa_keyword
            identifier: ibexa_keyword
        -
            type: ibexa_media
            name: ibexa_media
            identifier: ibexa_media
            field-settings:
                mediaType: html5_video
            validator-configuration:
                FileSizeValidator: { maxFileSize: 345 }
        -
            type: ibexa_object_relation
            name: ibexa_object_relation
            identifier: ibexa_object_relation
            field-settings:
                selectionMethod: 1
                selectionRoot: 2
        -
            type: ibexa_object_relation_list
            name: ibexa_object_relation_list
            identifier: ibexa_object_relation_list
            field-settings:
                selectionMethod: 1
                selectionDefaultLocation: 2
                selectionContentTypes: [ folder ]
        -
            type: ibexa_selection
            name: ibexa_selection
            identifier: ibexa_selection
            field-settings:
                isMultiple: true
                options: [ one, two ]
        # nb: ezsrrating fieldType seems to be enabled by default, but the db table might *not* be present...
        #-
        #    type: ezsrrating
        #    name: ezsrrating
        #    identifier: ezsrrating
        -
            type: ibexa_string
            name: ibexa_string
            identifier: ibexa_string
            validator-configuration:
                  StringLengthValidator: { maxStringLength: 255, minStringLength: 1 }
        -
            type: ibexa_text
            name: ibexa_text
            identifier: ibexa_text
            field-settings:
                textRows: 25
        -
            type: ibexa_time
            name: ibexa_time
            identifier: ibexa_time
            field-settings:
                defaultType: 1
                useSeconds: true
        -
            type: ibexa_url
            name: ibexa_url
            identifier: ibexa_url
        -
            type: ibexa_user
            name: ibexa_user
            identifier: ibexa_user
    references:
        -
            identifier: kmb_test_003_6_count
            attribute: count

-
    type: assert
    target: reference
    identifier: reference:kmb_test_003_6_count
    test:
        equals: 1

-
    type: content_type
    mode: update
    match:
        identifier: kmb_test_1
    attributes:
        -
            name: The Subtitle
            identifier: ibexa_string
            new_identifier: subtitle
        -
            name: An Image
            description: An Image Field
            identifier: ibexa_image
            new_identifier: image
    references:
        -
            identifier: kmb_test_003_8_count
            attribute: count

-
    type: assert
    target: reference
    identifier: reference:kmb_test_003_8_count
    test:
        equals: 1

-
    type: content_type
    mode: update
    match:
        identifier: 'reference:kmb_test_003_1_identifier'
    remove_attributes:
        - subtitle
        - image
    references:
        -
            identifier: kmb_test_003_10_count
            attribute: count

-
    type: assert
    target: reference
    identifier: reference:kmb_test_003_10_count
    test:
        equals: 1

-
    type: content_type
    mode: update
    match:
        identifier: 'reference:kmb_test_003_1_identifier'
    new_identifier: kmb_test_1_1
    content_type_group: 2
    remove_type_group: 1
    references:
        -
            identifier: kmb_test_003_12_identifier
            attribute: identifier
        -
            identifier: kmb_test_003_12_count
            attribute: count

-
    type: assert
    target: reference
    identifier: reference:kmb_test_003_12_identifier
    test:
        equals: kmb_test_1_1

-
    type: assert
    target: reference
    identifier: reference:kmb_test_003_12_count
    test:
        equals: 1

-
    type: content_type
    mode: update
    match:
        identifier: 'reference:kmb_test_003_12_identifier'
    default_sort_field: name
    default_sort_order: desc
    remove_drafts: true
    references:
        -
            identifier: kmb_test_003_15_count
            attribute: count

-
    type: assert
    target: reference
    identifier: reference:kmb_test_003_15_count
    test:
        equals: 1

-
    type: content_type
    mode: load
    match:
        content_type_identifier: kmb_test_1_1
    references:
        -
            identifier: dear
            attribute: 'attributes.title.required'
        -
            identifier: world
            attribute: 'attributes.ibexa_object_relation_list."field-settings".selectionContentTypes.length(@)'
        -
            identifier: goodbye
            attribute: content_type_groups_ids

-
    type: assert
    target: reference
    identifier: reference:dear
    test:
        equals: false

-
    type: assert
    target: reference
    identifier: reference:world
    test:
        equals: 1

-
    type: content_type
    mode: update
    match:
        identifier: 'reference:kmb_test_003_12_identifier'
    # add a thubmnail field
    attributes:
        -
            type: ibexa_image
            name: ezthumb
            identifier: ezthumb
            is-thumbnail: true

-
    type: content_type
    mode: update
    match:
        identifier: 'reference:kmb_test_003_12_identifier'
    # remove all attributes except the title
    attributes:
        -
            type: ibexa_string
            name: Title
            identifier: title
            description: Title
            required: true
            searchable: true
    remove_attributes: '*'

-
    type: content_type
    mode: delete
    match:
        identifier: 'reference:kmb_test_003_12_identifier'
    references:
        -
            identifier: kmb_test_003_20_count
            attribute: count

-
    type: assert
    target: reference
    identifier: reference:kmb_test_003_20_count
    test:
        equals: 1
