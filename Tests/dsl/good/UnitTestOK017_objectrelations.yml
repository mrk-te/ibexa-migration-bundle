# test that updating of object-relations attributes works as intended.
# Also, test usage of expressions to use non-basic selectors to assign references

-
    type: content_type
    mode: create
    content_type_group: 1
    identifier: kmb_test_17
    name: Kaliop Migration Bundle Test Class 17
    name_pattern: '<title>'
    attributes:
        -
            type: ibexa_string
            name: title
            identifier: title
        -
            type: ibexa_object_relation_list
            name: ibexa_object_relation_list
            identifier: ibexa_object_relation_list

-
    type: content
    mode: create
    content_type: kmb_test_17
    parent_location: 2
    attributes:
        title: test object
        ibexa_object_relation_list: [ 49 ]
    references:
        -
            identifier: hello
            attribute: content_id

-
    type: content
    mode: update
    match:
        content_id: reference:hello
    attributes:
        ibexa_object_relation_list: [ 41 ]

-
    type: content
    mode: load
    match:
        content_id: reference:hello
    references:
        -
            identifier: dear
            attribute: 'attributes.ibexa_object_relation_list.destinationContentIds[0]'
        -
            identifier: world
            attribute: 'attributes.ibexa_object_relation_list.destinationContentIds.length(@)'

-
    type: assert
    target: reference
    identifier: reference:dear
    test:
        equals: 41

-
    type: assert
    target: reference
    identifier: reference:world
    test:
        equals: 1

-
    type: content
    mode: delete
    match:
        content_id: reference:hello

-
    type: content_type
    mode: delete
    match:
        identifier: kmb_test_17
